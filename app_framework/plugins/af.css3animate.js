/**
 * af.css3animate - a css3 animation library that supports chaning/callbacks
 * Copyright 2013 - Intel
 */
!function($){var cache=[],objId=function(obj){return obj.afCSS3AnimateId||(obj.afCSS3AnimateId=$.uuid()),obj.afCSS3AnimateId},getEl=function(elID){return"string"==typeof elID||elID instanceof String?document.getElementById(elID):$.is$(elID)?elID[0]:elID},getCSS3Animate=function(obj,options){var tmp,id,el=getEl(obj);//first one
return id=objId(el),cache[id]?(cache[id].animate(options),tmp=cache[id]):(tmp=css3Animate(el,options),cache[id]=tmp),tmp};$.fn.css3Animate=function(opts){//keep old callback system - backwards compatibility - should be deprecated in future versions
!opts.complete&&opts.callback&&(opts.complete=opts.callback);//first on
var tmp=getCSS3Animate(this[0],opts);opts.complete=null,opts.sucess=null,opts.failure=null;for(var i=1;i<this.length;i++)tmp.link(this[i],opts);return tmp},$.css3AnimateQueue=function(){return new css3Animate.queue};var translateOpen=$.feat.cssTransformStart,translateClose=$.feat.cssTransformEnd,transitionEnd=$.feat.cssPrefix.replace(/-/g,"")+"TransitionEnd";transitionEnd=$.os.fennec||""===$.feat.cssPrefix||$.os.ie?"transitionend":transitionEnd,transitionEnd=transitionEnd.replace(transitionEnd.charAt(0),transitionEnd.charAt(0).toLowerCase());var css3Animate=function(){var css3Animate=function(elID,options){if(!(this instanceof css3Animate))return new css3Animate(elID,options);if(//start doing stuff
this.callbacksStack=[],this.activeEvent=null,this.countStack=0,this.isActive=!1,this.el=elID,this.linkFinishedProxy_=$.proxy(this.linkFinished,this),this.el){this.animate(options);var that=this;af(this.el).bind("destroy",function(){var id=that.el.afCSS3AnimateId;that.callbacksStack=[],cache[id]&&delete cache[id]})}};return css3Animate.prototype={animate:function(options){if(//cancel current active animation on this object
this.isActive&&this.cancel(),this.isActive=!0,!options)return alert("Please provide configuration options for animation of "+this.el.id),void 0;var scale,time,classMode=!!options.addClass,timeNum=numOnly(options.time);if(classMode)//class defines properties being changed
options.removeClass?af(this.el).replaceClass(options.removeClass,options.addClass):af(this.el).addClass(options.addClass);else{if(//property by property
0===timeNum&&(options.time=0),options.y||(options.y=0),options.x||(options.x=0),options.previous){var cssMatrix=new $.getCssMatrix(this.el);options.y+=numOnly(cssMatrix.f),options.x+=numOnly(cssMatrix.e)}options.origin||(options.origin="0% 0%"),options.scale||(options.scale="1"),options.rotateY||(options.rotateY="0"),options.rotateX||(options.rotateX="0"),options.skewY||(options.skewY="0"),options.skewX||(options.skewX="0"),options.timingFunction||(options.timingFunction="linear"),//check for percent or numbers
("number"==typeof options.x||-1==options.x.indexOf("%")&&-1==options.x.toLowerCase().indexOf("px")&&-1==options.x.toLowerCase().indexOf("deg"))&&(options.x=parseInt(options.x,10)+"px"),("number"==typeof options.y||-1==options.y.indexOf("%")&&-1==options.y.toLowerCase().indexOf("px")&&-1==options.y.toLowerCase().indexOf("deg"))&&(options.y=parseInt(options.y,10)+"px");var trans="translate"+translateOpen+options.x+","+options.y+translateClose+" scale("+parseFloat(options.scale)+") rotate("+options.rotateX+")";$.os.opera||(trans+=" rotateY("+options.rotateY+")"),trans+=" skew("+options.skewX+","+options.skewY+")",this.el.style[$.feat.cssPrefix+"Transform"]=trans,this.el.style[$.feat.cssPrefix+"BackfaceVisibility"]="hidden";var properties=$.feat.cssPrefix+"Transform";void 0!==options.opacity&&(this.el.style.opacity=options.opacity,properties+=", opacity"),options.width&&(this.el.style.width=options.width,properties="all"),options.height&&(this.el.style.height=options.height,properties="all"),this.el.style[$.feat.cssPrefix+"TransitionProperty"]="all",-1===(""+options.time).indexOf("s")?(scale="ms",time=options.time+scale):-1!==options.time.indexOf("ms")?(scale="ms",time=options.time):(scale="s",time=options.time+scale),options.delay&&(this.el.style[$.feat.cssPrefix+"TransitionDelay"]=options.delay),this.el.style[$.feat.cssPrefix+"TransitionDuration"]=time,this.el.style[$.feat.cssPrefix+"TransitionTimingFunction"]=options.timingFunction,this.el.style[$.feat.cssPrefix+"TransformOrigin"]=options.origin}//add callback to the stack
this.callbacksStack.push({complete:options.complete,success:options.success,failure:options.failure}),this.countStack++;var duration,that=this,style=window.getComputedStyle(this.el);classMode&&(//get the duration
duration=style[$.feat.cssPrefix+"TransitionDuration"],timeNum=numOnly(duration),options.time=timeNum,-1!==duration.indexOf("ms")?scale="ms":(scale="s",options.time*=1e3)),//finish asap
0===timeNum||"ms"==scale&&5>timeNum||"none"==style.display?//the duration is nearly 0 or the element is not displayed, finish immediatly
$.asap($.proxy(this.finishAnimation,this,[!1])):(//setup the event normally
this.activeEvent=function(event){clearTimeout(that.timeout),that.finishAnimation(event),that.el.removeEventListener(transitionEnd,that.activeEvent,!1)},that.timeout=setTimeout(this.activeEvent,numOnly(options.time)+50),this.el.addEventListener(transitionEnd,this.activeEvent,!1))},addCallbackHook:function(callback){return callback&&this.callbacksStack.push(callback),this.countStack++,this.linkFinishedProxy_},linkFinished:function(canceled){canceled?this.cancel():this.finishAnimation()},finishAnimation:function(event){event&&event.preventDefault&&event.preventDefault(),this.isActive&&(this.countStack--,0===this.countStack&&this.fireCallbacks(!1))},fireCallbacks:function(canceled){this.clearEvents();//keep callbacks after cleanup
// (if any of the callbacks overrides this object, callbacks will keep on fire as expected)
var callbacks=this.callbacksStack;//cleanup
this.cleanup();//fire all callbacks
for(var i=0;i<callbacks.length;i++){var complete=callbacks[i].complete,success=callbacks[i].success,failure=callbacks[i].failure;//fire callbacks
complete&&"function"==typeof complete&&complete(canceled),//success/failure
canceled&&failure&&"function"==typeof failure?failure():success&&"function"==typeof success&&success()}},cancel:function(){this.isActive&&this.fireCallbacks(!0)},cleanup:function(){this.callbacksStack=[],this.isActive=!1,this.countStack=0},clearEvents:function(){this.activeEvent&&this.el.removeEventListener(transitionEnd,this.activeEvent,!1),this.activeEvent=null},link:function(elID,opts){var callbacks={complete:opts.complete,success:opts.success,failure:opts.failure};return opts.complete=this.addCallbackHook(callbacks),opts.success=null,opts.failure=null,//run the animation with the replaced callbacks
getCSS3Animate(elID,opts),//set the old callback back in the obj to avoid strange stuff
opts.complete=callbacks.complete,opts.success=callbacks.success,opts.failure=callbacks.failure,this}},css3Animate}();css3Animate.queue=function(){return{elements:[],push:function(el){this.elements.push(el)},pop:function(){return this.elements.pop()},run:function(){var that=this;if(0!==this.elements.length){if("function"==typeof this.elements[0]){var func=this.shift();func()}if(0!==this.elements.length){var params=this.shift();this.elements.length>0&&(params.complete=function(canceled){canceled||that.run()}),css3Animate(document.getElementById(params.id),params)}}},shift:function(){return this.elements.shift()}}}}(af);